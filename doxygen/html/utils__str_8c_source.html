<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Grisbi:  Fichier source de utils_str.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Généré par Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Page&nbsp;principale</span></a></li>
      <li><a href="pages.html"><span>Pages&nbsp;associées</span></a></li>
      <li><a href="annotated.html"><span>Structures&nbsp;de&nbsp;données</span></a></li>
      <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>Liste&nbsp;des&nbsp;fichiers</span></a></li>
      <li><a href="globals.html"><span>Portée&nbsp;globale</span></a></li>
    </ul>
  </div>
<h1>utils_str.c</h1><a href="utils__str_8c.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* ************************************************************************** */</span>
<a name="l00002"></a>00002 <span class="comment">/*                                  utils_str.c                               */</span>
<a name="l00003"></a>00003 <span class="comment">/*                                                                            */</span>
<a name="l00004"></a>00004 <span class="comment">/*     Copyright (C)    2000-2008 Cedric Auger (cedric@grisbi.org)            */</span>
<a name="l00005"></a>00005 <span class="comment">/*          2003-2008 Benjamin Drieu (bdrieu@april.org)                       */</span>
<a name="l00006"></a>00006 <span class="comment">/*          2008-2010 Pierre Biava (grisbi@pierre.biava.name)                 */</span>
<a name="l00007"></a>00007 <span class="comment">/*          http://www.grisbi.org                                             */</span>
<a name="l00008"></a>00008 <span class="comment">/*                                                                            */</span>
<a name="l00009"></a>00009 <span class="comment">/*  This program is free software; you can redistribute it and/or modify      */</span>
<a name="l00010"></a>00010 <span class="comment">/*  it under the terms of the GNU General Public License as published by      */</span>
<a name="l00011"></a>00011 <span class="comment">/*  the Free Software Foundation; either version 2 of the License, or         */</span>
<a name="l00012"></a>00012 <span class="comment">/*  (at your option) any later version.                                       */</span>
<a name="l00013"></a>00013 <span class="comment">/*                                                                            */</span>
<a name="l00014"></a>00014 <span class="comment">/*  This program is distributed in the hope that it will be useful,           */</span>
<a name="l00015"></a>00015 <span class="comment">/*  but WITHOUT ANY WARRANTY; without even the implied warranty of            */</span>
<a name="l00016"></a>00016 <span class="comment">/*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             */</span>
<a name="l00017"></a>00017 <span class="comment">/*  GNU General Public License for more details.                              */</span>
<a name="l00018"></a>00018 <span class="comment">/*                                                                            */</span>
<a name="l00019"></a>00019 <span class="comment">/*  You should have received a copy of the GNU General Public License         */</span>
<a name="l00020"></a>00020 <span class="comment">/*  along with this program; if not, write to the Free Software               */</span>
<a name="l00021"></a>00021 <span class="comment">/*  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA */</span>
<a name="l00022"></a>00022 <span class="comment">/*                                                                            */</span>
<a name="l00023"></a>00023 <span class="comment">/* ************************************************************************** */</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="include_8h.html">include.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">/*START_INCLUDE*/</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="utils__str_8h.html">utils_str.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="gsb__data__report_8h.html">gsb_data_report.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="comment">/*END_INCLUDE*/</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="comment">/*START_STATIC*/</span>
<a name="l00034"></a>00034 <span class="keyword">static</span> gchar *gsb_string_supprime_joker ( <span class="keyword">const</span> gchar *chaine );
<a name="l00035"></a>00035 <span class="keyword">static</span> gchar * gsb_string_truncate_n ( gchar * <span class="keywordtype">string</span>, <span class="keywordtype">int</span> n, gboolean hard_trunc );
<a name="l00036"></a>00036 <span class="comment">/*END_STATIC*/</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="comment">/*START_EXTERN*/</span>
<a name="l00040"></a>00040 <span class="comment">/*END_EXTERN*/</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 
<a name="l00056"></a><a class="code" href="utils__str_8h.html#a1e50f3be459180b9dea9f14eb7e1204e">00056</a> gchar *<a class="code" href="utils__str_8c.html#a1e50f3be459180b9dea9f14eb7e1204e" title="convert an integer into a gchar based string">utils_str_itoa</a> ( gint integer )
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058     div_t result_div;
<a name="l00059"></a>00059     gchar *chaine;
<a name="l00060"></a>00060     gint i = 0;
<a name="l00061"></a>00061     gint num;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063     chaine = g_malloc0 ( 11*<span class="keyword">sizeof</span> (gchar) );
<a name="l00064"></a>00064     
<a name="l00065"></a>00065     num = abs(integer);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     <span class="comment">/* Construct the result in the reverse order from right to left, then reverse it. */</span>
<a name="l00068"></a>00068     <span class="keywordflow">do</span>
<a name="l00069"></a>00069     {
<a name="l00070"></a>00070         result_div = div ( num, 10 );
<a name="l00071"></a>00071         chaine[i] = result_div.rem + <span class="charliteral">&#39;0&#39;</span>; 
<a name="l00072"></a>00072         i++;
<a name="l00073"></a>00073     }
<a name="l00074"></a>00074     <span class="keywordflow">while</span> ( ( num = result_div.quot ));
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     <span class="comment">/* Add the sign at the end of the string just before to reverse it to avoid</span>
<a name="l00077"></a>00077 <span class="comment">     to have to insert it at the begin just after... */</span>
<a name="l00078"></a>00078     <span class="keywordflow">if</span> (integer &lt; 0)
<a name="l00079"></a>00079     {
<a name="l00080"></a>00080         chaine[i++] = <span class="charliteral">&#39;-&#39;</span>;
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082     
<a name="l00083"></a>00083     chaine[i] = 0;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     g_strreverse ( chaine );
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     <span class="keywordflow">return</span> ( chaine );
<a name="l00088"></a>00088 }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 
<a name="l00104"></a><a class="code" href="utils__str_8h.html#a405fb140e26d92c4f1c5f7e41b82d547">00104</a> gchar *<a class="code" href="utils__str_8c.html#a405fb140e26d92c4f1c5f7e41b82d547">utils_str_reduce_exponant_from_string</a> ( <span class="keyword">const</span> gchar *amount_string,
<a name="l00105"></a>00105                         gint exponent )
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107     gchar *return_string;
<a name="l00108"></a>00108     gchar *p;
<a name="l00109"></a>00109     gchar *mon_decimal_point;
<a name="l00110"></a>00110     gunichar decimal_point = (gunichar )-2;
<a name="l00111"></a>00111     <span class="keyword">struct </span>lconv *conv = localeconv ( );
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     <span class="keywordflow">if</span> ( !amount_string )
<a name="l00114"></a>00114             <span class="keywordflow">return</span> NULL;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     mon_decimal_point = g_locale_to_utf8 ( conv-&gt;mon_decimal_point,
<a name="l00117"></a>00117                         -1, NULL, NULL, NULL );
<a name="l00118"></a>00118     <span class="keywordflow">if</span> ( mon_decimal_point )
<a name="l00119"></a>00119         decimal_point = g_utf8_get_char_validated ( mon_decimal_point, -1 );
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     return_string = <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> ( amount_string );
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     <span class="keywordflow">if</span> ( ( p = g_utf8_strrchr ( (<span class="keyword">const</span> gchar *) return_string, -1, <span class="charliteral">&#39;.&#39;</span> ) ) )
<a name="l00124"></a>00124     {
<a name="l00125"></a>00125         <span class="keywordflow">if</span> ( g_unichar_isdefined ( decimal_point )
<a name="l00126"></a>00126          &amp;&amp;
<a name="l00127"></a>00127          g_utf8_strchr ( p, 1, decimal_point ) == NULL )
<a name="l00128"></a>00128         {
<a name="l00129"></a>00129             gchar **tab;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131             tab = g_strsplit ( return_string, <span class="stringliteral">&quot;.&quot;</span>, 2 );
<a name="l00132"></a>00132             return_string = g_strjoinv ( mon_decimal_point, tab );
<a name="l00133"></a>00133             g_strfreev ( tab );
<a name="l00134"></a>00134             p = g_utf8_strrchr ( (<span class="keyword">const</span> gchar *) return_string, -1,
<a name="l00135"></a>00135                         decimal_point );
<a name="l00136"></a>00136         }
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ( p = g_utf8_strrchr ( (<span class="keyword">const</span> gchar *) return_string, -1, <span class="charliteral">&#39;,&#39;</span> ) ) )
<a name="l00139"></a>00139     {
<a name="l00140"></a>00140         <span class="keywordflow">if</span> ( g_unichar_isdefined ( decimal_point )
<a name="l00141"></a>00141          &amp;&amp;
<a name="l00142"></a>00142          g_utf8_strchr ( p, 1, decimal_point ) == NULL )
<a name="l00143"></a>00143         {
<a name="l00144"></a>00144             gchar **tab;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146             tab = g_strsplit ( return_string, <span class="stringliteral">&quot;,&quot;</span>, 2 );
<a name="l00147"></a>00147             return_string = g_strjoinv ( mon_decimal_point, tab );
<a name="l00148"></a>00148             g_strfreev ( tab );
<a name="l00149"></a>00149             p = g_utf8_strrchr ( (<span class="keyword">const</span> gchar *) return_string, -1,
<a name="l00150"></a>00150                         decimal_point );
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152     }
<a name="l00153"></a>00153     <span class="keywordflow">else</span>
<a name="l00154"></a>00154         <span class="keywordflow">return</span> NULL;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     p[exponent + 1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     <span class="keywordflow">return</span> return_string;
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 
<a name="l00168"></a><a class="code" href="utils__str_8h.html#ac5358e3ba8d2c9eba77b254e9ccb7590">00168</a> gchar *<a class="code" href="utils__str_8c.html#ac5358e3ba8d2c9eba77b254e9ccb7590">utils_str_localise_decimal_point_from_string</a> ( <span class="keyword">const</span> gchar *<span class="keywordtype">string</span> )
<a name="l00169"></a>00169 {
<a name="l00170"></a>00170     <span class="keyword">struct </span>lconv *conv = localeconv ( );
<a name="l00171"></a>00171     gchar *ptr_1, *ptr_2;
<a name="l00172"></a>00172     gchar *new_str;
<a name="l00173"></a>00173     gchar *mon_decimal_point;
<a name="l00174"></a>00174     gchar *mon_separateur;
<a name="l00175"></a>00175     gchar **tab;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     mon_decimal_point = g_locale_to_utf8 ( conv-&gt;mon_decimal_point, -1, NULL, NULL, NULL );
<a name="l00178"></a>00178     mon_separateur = g_locale_to_utf8 ( conv-&gt;mon_thousands_sep, -1, NULL, NULL, NULL );
<a name="l00179"></a>00179 
<a name="l00180"></a>00180     <span class="keywordflow">if</span> ( ( ptr_1 = g_strstr_len ( <span class="keywordtype">string</span>, -1, <span class="stringliteral">&quot;,&quot;</span> ) )
<a name="l00181"></a>00181      &amp;&amp;
<a name="l00182"></a>00182      ( ptr_2 = g_strrstr ( <span class="keywordtype">string</span>, <span class="stringliteral">&quot;.&quot;</span> ) ) )
<a name="l00183"></a>00183     {
<a name="l00184"></a>00184         <span class="keywordflow">if</span> ( ( ptr_2 - <span class="keywordtype">string</span> ) &gt; ( ptr_1 - <span class="keywordtype">string</span> ) )
<a name="l00185"></a>00185             tab = g_strsplit ( <span class="keywordtype">string</span>, <span class="stringliteral">&quot;,&quot;</span>, 0 );
<a name="l00186"></a>00186         <span class="keywordflow">else</span>
<a name="l00187"></a>00187             tab = g_strsplit ( <span class="keywordtype">string</span>, <span class="stringliteral">&quot;.&quot;</span>, 0 );
<a name="l00188"></a>00188 
<a name="l00189"></a>00189         new_str = g_strjoinv ( <span class="stringliteral">&quot;&quot;</span>, tab );
<a name="l00190"></a>00190         g_strfreev ( tab );
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192     <span class="keywordflow">else</span>
<a name="l00193"></a>00193         new_str = g_strdup ( <span class="keywordtype">string</span> );
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="keywordflow">if</span> ( mon_decimal_point &amp;&amp; g_strstr_len ( new_str, -1, mon_decimal_point ) == NULL )
<a name="l00196"></a>00196     {
<a name="l00197"></a>00197         tab = g_strsplit_set ( new_str, <span class="stringliteral">&quot;.,&quot;</span>, 0 );
<a name="l00198"></a>00198         g_free ( new_str );
<a name="l00199"></a>00199         new_str = g_strjoinv ( mon_decimal_point, tab );
<a name="l00200"></a>00200         g_strfreev ( tab );
<a name="l00201"></a>00201     }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     <span class="keywordflow">if</span> ( mon_decimal_point )
<a name="l00204"></a>00204         g_free ( mon_decimal_point );
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="keywordflow">if</span> ( mon_separateur &amp;&amp; g_strstr_len ( new_str, -1, mon_separateur ) )
<a name="l00207"></a>00207     {
<a name="l00208"></a>00208         tab = g_strsplit ( new_str, <span class="stringliteral">&quot; &quot;</span>, 0 );
<a name="l00209"></a>00209         g_free ( new_str );
<a name="l00210"></a>00210         new_str = g_strjoinv ( <span class="stringliteral">&quot;&quot;</span>, tab );
<a name="l00211"></a>00211         g_strfreev ( tab );
<a name="l00212"></a>00212     }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     <span class="keywordflow">if</span> ( mon_separateur )
<a name="l00215"></a>00215         g_free ( mon_separateur );
<a name="l00216"></a>00216 
<a name="l00217"></a>00217     <span class="keywordflow">return</span> new_str;
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 
<a name="l00232"></a><a class="code" href="utils__str_8h.html#a5653e4c704f0c344ca9d1549561f9cd3">00232</a> G_MODULE_EXPORT gint <a class="code" href="utils__str_8c.html#a5653e4c704f0c344ca9d1549561f9cd3" title="Secured version of atoi.">utils_str_atoi</a> ( <span class="keyword">const</span> gchar *chaine )
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234     <span class="keywordflow">if</span> ((chaine )&amp;&amp;(*chaine))
<a name="l00235"></a>00235     {
<a name="l00236"></a>00236         <span class="keywordflow">return</span> ( atoi ( chaine ));
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238     <span class="keywordflow">else</span>
<a name="l00239"></a>00239     {
<a name="l00240"></a>00240         <span class="keywordflow">return</span> ( 0 );
<a name="l00241"></a>00241     }
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 
<a name="l00259"></a><a class="code" href="utils__str_8h.html#afd559e6aa481ff484dc3eefad3b0beff">00259</a> <span class="keywordtype">double</span> <a class="code" href="utils__str_8c.html#afd559e6aa481ff484dc3eefad3b0beff">my_strtod</a> ( <span class="keyword">const</span> gchar *nptr, gchar **endptr )
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261     <span class="keywordtype">double</span> entier= 0, mantisse = 0, resultat = 0;
<a name="l00262"></a>00262     gint invert = 0;
<a name="l00263"></a>00263     <span class="keyword">const</span> gchar *p;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     <span class="keywordflow">if</span> ( !nptr )
<a name="l00266"></a>00266         <span class="keywordflow">return</span> 0;
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     <span class="keywordflow">for</span> ( p = nptr; p &lt; nptr + strlen ( nptr ); p++ )
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270         <span class="keywordflow">if</span> ( g_ascii_isspace ( *p ) || *p == <span class="charliteral">&#39;+&#39;</span> )
<a name="l00271"></a>00271             <span class="keywordflow">continue</span>;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273         <span class="keywordflow">if</span> ( *p == <span class="charliteral">&#39;-&#39;</span> )
<a name="l00274"></a>00274         {
<a name="l00275"></a>00275             invert = 1;
<a name="l00276"></a>00276             <span class="keywordflow">continue</span>;
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279         <span class="comment">/* on traite ici la partie décimale */</span>
<a name="l00280"></a>00280         <span class="keywordflow">if</span> ( *p == <span class="charliteral">&#39;,&#39;</span> || *p == <span class="charliteral">&#39;.&#39;</span> )
<a name="l00281"></a>00281         {
<a name="l00282"></a>00282             <span class="keyword">const</span> gchar *m;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284             <span class="keywordflow">for</span> ( m = p + 1; m &lt;= nptr + strlen ( nptr ) &amp;&amp;
<a name="l00285"></a>00285              ( g_ascii_isdigit ( *m ) || g_ascii_isspace ( *m ) ); m++ )
<a name="l00286"></a>00286                 <span class="comment">/* Nothing, just loop pour atteindre la fin de la chaine ou le dernier</span>
<a name="l00287"></a>00287 <span class="comment">                 * caractère utilisable */</span>
<a name="l00288"></a>00288                 ;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290             <span class="keywordflow">if</span> ( strlen ( m ) &gt; 0 )
<a name="l00291"></a>00291             {
<a name="l00292"></a>00292                 gchar *tmp_str = NULL;
<a name="l00293"></a>00293                 gchar *tmp_str_2 = NULL;
<a name="l00294"></a>00294                 <span class="keyword">const</span> gchar *ptr;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296                 <span class="keywordflow">for</span> ( ptr = m; ptr &lt; m + strlen ( m ); ptr++ )
<a name="l00297"></a>00297                 {
<a name="l00298"></a>00298                     tmp_str = g_strndup ( ptr, 1 );
<a name="l00299"></a>00299                     <span class="keywordflow">if</span> ( tmp_str_2 == NULL )
<a name="l00300"></a>00300                         tmp_str_2 = g_strconcat ( tmp_str, <span class="stringliteral">&quot;|&quot;</span>, NULL );
<a name="l00301"></a>00301                     <span class="keywordflow">else</span>
<a name="l00302"></a>00302                         tmp_str_2 = g_strconcat ( tmp_str_2, tmp_str, <span class="stringliteral">&quot;|&quot;</span>, NULL );
<a name="l00303"></a>00303                     g_free ( tmp_str );
<a name="l00304"></a>00304                 }
<a name="l00305"></a>00305                 endptr = g_strsplit ( tmp_str_2, <span class="stringliteral">&quot;|&quot;</span>, strlen ( m ) );
<a name="l00306"></a>00306                 g_free ( tmp_str_2 );
<a name="l00307"></a>00307             }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309             <span class="keywordflow">for</span> ( --m; m &gt; p; m-- )
<a name="l00310"></a>00310             {
<a name="l00311"></a>00311                 <span class="keywordflow">if</span> ( isdigit ( *m ) )
<a name="l00312"></a>00312                 {
<a name="l00313"></a>00313                     mantisse /= 10;
<a name="l00314"></a>00314                     mantisse += ( *m - <span class="charliteral">&#39;0&#39;</span> );
<a name="l00315"></a>00315                 }
<a name="l00316"></a>00316             }
<a name="l00317"></a>00317             mantisse /= 10;
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320         <span class="comment">/* on traite ici la partie entière */</span>
<a name="l00321"></a>00321         <span class="keywordflow">if</span> ( isdigit ( *p ) )
<a name="l00322"></a>00322         {
<a name="l00323"></a>00323             entier = entier * 10;
<a name="l00324"></a>00324             entier += ( *p - <span class="charliteral">&#39;0&#39;</span> );
<a name="l00325"></a>00325         }
<a name="l00326"></a>00326         <span class="keywordflow">else</span>
<a name="l00327"></a>00327         {
<a name="l00328"></a>00328             <span class="keywordflow">break</span>;
<a name="l00329"></a>00329         }
<a name="l00330"></a>00330     }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     resultat = entier + mantisse;
<a name="l00333"></a>00333     <span class="keywordflow">if</span> ( invert )
<a name="l00334"></a>00334         resultat = - resultat;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="keywordflow">return</span> resultat;
<a name="l00337"></a>00337 }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 
<a name="l00346"></a><a class="code" href="utils__str_8h.html#ab704c07d882cce97ac79ab6ad7623e60">00346</a> G_MODULE_EXPORT gchar * <a class="code" href="utils__str_8c.html#ab704c07d882cce97ac79ab6ad7623e60">latin2utf8</a> ( <span class="keyword">const</span> gchar * inchar)
<a name="l00347"></a>00347 {
<a name="l00348"></a>00348     <span class="keywordflow">return</span> g_locale_from_utf8 ( inchar, -1, NULL, NULL, NULL );
<a name="l00349"></a>00349 }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351 
<a name="l00363"></a><a class="code" href="utils__str_8h.html#a132f77383d5b1e3070ef354a1fdd8a10">00363</a> gchar *<a class="code" href="utils__str_8c.html#a132f77383d5b1e3070ef354a1fdd8a10">my_strdelimit</a> ( <span class="keyword">const</span> gchar *<span class="keywordtype">string</span>,
<a name="l00364"></a>00364                         <span class="keyword">const</span> gchar *delimiters,
<a name="l00365"></a>00365                         <span class="keyword">const</span> gchar *new_delimiters )
<a name="l00366"></a>00366 {
<a name="l00367"></a>00367     gchar **tab_str;
<a name="l00368"></a>00368     gchar *retour;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     <span class="keywordflow">if</span> ( !( <span class="keywordtype">string</span>
<a name="l00371"></a>00371             &amp;&amp;
<a name="l00372"></a>00372             delimiters
<a name="l00373"></a>00373             &amp;&amp;
<a name="l00374"></a>00374             new_delimiters ))
<a name="l00375"></a>00375         <span class="keywordflow">return</span> <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (<span class="keywordtype">string</span>);
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     tab_str = g_strsplit_set ( <span class="keywordtype">string</span>,
<a name="l00378"></a>00378                                delimiters,
<a name="l00379"></a>00379                                0 );
<a name="l00380"></a>00380     retour = g_strjoinv ( new_delimiters,
<a name="l00381"></a>00381                           tab_str );
<a name="l00382"></a>00382     g_strfreev ( tab_str );
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     <span class="keywordflow">return</span> ( retour );
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00394"></a><a class="code" href="utils__str_8h.html#a031629b031394a54e85e1230c3eb3d19">00394</a> gint <a class="code" href="utils__str_8c.html#a031629b031394a54e85e1230c3eb3d19">my_strcmp</a> ( gchar *string_1, gchar *string_2 )
<a name="l00395"></a>00395 {
<a name="l00396"></a>00396     <span class="keywordflow">if</span> (!string_1 &amp;&amp; string_2)
<a name="l00397"></a>00397             <span class="keywordflow">return</span> 1;
<a name="l00398"></a>00398     <span class="keywordflow">if</span> (string_1 &amp;&amp; !string_2)
<a name="l00399"></a>00399             <span class="keywordflow">return</span> -1;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 
<a name="l00402"></a>00402         <span class="keywordflow">if</span> ( g_utf8_validate ( string_1, -1, NULL )
<a name="l00403"></a>00403              &amp;&amp;
<a name="l00404"></a>00404              g_utf8_validate ( string_2, -1, NULL ))
<a name="l00405"></a>00405         {
<a name="l00406"></a>00406             gint retour;
<a name="l00407"></a>00407             gchar *new_1, *new_2;
<a name="l00408"></a>00408             
<a name="l00409"></a>00409             new_1 = g_utf8_collate_key ( string_1, -1 );
<a name="l00410"></a>00410             new_2 = g_utf8_collate_key ( string_2, -1 );
<a name="l00411"></a>00411             retour = strcmp ( new_1, new_2 );
<a name="l00412"></a>00412 
<a name="l00413"></a>00413             g_free ( new_1 );
<a name="l00414"></a>00414             g_free ( new_2 );
<a name="l00415"></a>00415             <span class="keywordflow">return</span> ( retour );
<a name="l00416"></a>00416         }
<a name="l00417"></a>00417         <span class="keywordflow">else</span>
<a name="l00418"></a>00418             <span class="keywordflow">return</span> ( strcmp ( string_1, string_2 ) );
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <span class="keywordflow">return</span> 0;
<a name="l00421"></a>00421 }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 
<a name="l00433"></a><a class="code" href="utils__str_8h.html#af2728abf4fbd2d14f13a3025211dab47">00433</a> gint <a class="code" href="utils__str_8c.html#af2728abf4fbd2d14f13a3025211dab47">my_strcasecmp</a> ( <span class="keyword">const</span> gchar *string_1, <span class="keyword">const</span> gchar *string_2 )
<a name="l00434"></a>00434 {
<a name="l00435"></a>00435     <span class="keywordflow">if</span> (!string_1 &amp;&amp; string_2)
<a name="l00436"></a>00436             <span class="keywordflow">return</span> 1;
<a name="l00437"></a>00437     <span class="keywordflow">if</span> (string_1 &amp;&amp; !string_2)
<a name="l00438"></a>00438             <span class="keywordflow">return</span> -1;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440     <span class="keywordflow">if</span> ( string_1  &amp;&amp; string_2 )
<a name="l00441"></a>00441     {
<a name="l00442"></a>00442         <span class="keywordflow">if</span> ( g_utf8_validate ( string_1, -1, NULL )
<a name="l00443"></a>00443              &amp;&amp;
<a name="l00444"></a>00444              g_utf8_validate ( string_2, -1, NULL ))
<a name="l00445"></a>00445         {
<a name="l00446"></a>00446             gint retour;
<a name="l00447"></a>00447             gchar *new_1, *new_2;
<a name="l00448"></a>00448             
<a name="l00449"></a>00449             new_1 = g_utf8_collate_key ( g_utf8_casefold ( string_1,-1 ),
<a name="l00450"></a>00450                          -1 );
<a name="l00451"></a>00451             new_2 = g_utf8_collate_key ( g_utf8_casefold (  string_2,-1 ),
<a name="l00452"></a>00452                          -1 );
<a name="l00453"></a>00453             retour = strcmp ( new_1,
<a name="l00454"></a>00454                       new_2 );
<a name="l00455"></a>00455             g_free ( new_1 );
<a name="l00456"></a>00456             g_free ( new_2 );
<a name="l00457"></a>00457             <span class="keywordflow">return</span> ( retour );
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459         <span class="keywordflow">else</span>
<a name="l00460"></a>00460             <span class="keywordflow">return</span> ( g_ascii_strcasecmp ( string_1, string_2 ) );
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463     <span class="keywordflow">return</span> 0;
<a name="l00464"></a>00464 }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466 
<a name="l00473"></a><a class="code" href="utils__str_8h.html#abf977b0f883489b8d4c6508f9aac3921">00473</a> gint <a class="code" href="utils__str_8c.html#abf977b0f883489b8d4c6508f9aac3921">my_strncasecmp</a> ( gchar *string_1,
<a name="l00474"></a>00474                         gchar *string_2,
<a name="l00475"></a>00475                         gint longueur )
<a name="l00476"></a>00476 {
<a name="l00477"></a>00477     <span class="keywordflow">if</span> (!string_1 &amp;&amp; string_2)
<a name="l00478"></a>00478         <span class="keywordflow">return</span> 1;
<a name="l00479"></a>00479     <span class="keywordflow">if</span> (string_1 &amp;&amp; !string_2)
<a name="l00480"></a>00480         <span class="keywordflow">return</span> -1;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="keywordflow">if</span> ( string_1 &amp;&amp; string_2 )
<a name="l00483"></a>00483     {
<a name="l00484"></a>00484         <span class="keywordflow">if</span> ( g_utf8_validate ( string_1, -1, NULL )
<a name="l00485"></a>00485              &amp;&amp;
<a name="l00486"></a>00486              g_utf8_validate ( string_2, -1, NULL ))
<a name="l00487"></a>00487         {
<a name="l00488"></a>00488             gint retour;
<a name="l00489"></a>00489             gchar *new_1, *new_2;
<a name="l00490"></a>00490             
<a name="l00491"></a>00491             new_1 = g_utf8_casefold ( string_1,longueur );
<a name="l00492"></a>00492             new_2 = g_utf8_casefold (  string_2,longueur );
<a name="l00493"></a>00493             retour = g_utf8_collate ( new_1, new_2);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495             g_free ( new_1 );
<a name="l00496"></a>00496             g_free ( new_2 );
<a name="l00497"></a>00497             <span class="keywordflow">return</span> ( retour );
<a name="l00498"></a>00498         }
<a name="l00499"></a>00499         <span class="keywordflow">else</span>
<a name="l00500"></a>00500             <span class="keywordflow">return</span> ( g_ascii_strncasecmp ( string_1, string_2, longueur ) );
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <span class="keywordflow">return</span> 0;
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 
<a name="l00519"></a><a class="code" href="utils__str_8h.html#ad9a37361694eeaa2847b0fe11389824d">00519</a> G_MODULE_EXPORT gchar *<a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> ( <span class="keyword">const</span> gchar *<span class="keywordtype">string</span> )
<a name="l00520"></a>00520 {
<a name="l00521"></a>00521     <span class="keywordflow">if</span> ( <span class="keywordtype">string</span> &amp;&amp; strlen (<span class="keywordtype">string</span>) )
<a name="l00522"></a>00522         <span class="keywordflow">return</span> g_strdup (<span class="keywordtype">string</span>);
<a name="l00523"></a>00523     <span class="keywordflow">else</span>
<a name="l00524"></a>00524         <span class="keywordflow">return</span> NULL;
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 
<a name="l00537"></a><a class="code" href="utils__str_8h.html#a67b348352595edf6bfbb1d64ad7c0f7b">00537</a> gchar *<a class="code" href="utils__str_8c.html#a67b348352595edf6bfbb1d64ad7c0f7b">limit_string</a> ( gchar *<span class="keywordtype">string</span>,
<a name="l00538"></a>00538                         gint length )
<a name="l00539"></a>00539 {
<a name="l00540"></a>00540     gchar *string_return;
<a name="l00541"></a>00541     gchar *tmpstr;
<a name="l00542"></a>00542     gint i;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <span class="keywordflow">if</span> ( !<span class="keywordtype">string</span> )
<a name="l00545"></a>00545         <span class="keywordflow">return</span> NULL;
<a name="l00546"></a>00546 
<a name="l00547"></a>00547     <span class="keywordflow">if</span> ( g_utf8_strlen ( <span class="keywordtype">string</span>, -1 ) &lt;= length )
<a name="l00548"></a>00548         <span class="keywordflow">return</span> <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> (<span class="keywordtype">string</span>);
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     string_return = <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> ( <span class="keywordtype">string</span> );
<a name="l00551"></a>00551     tmpstr = string_return;
<a name="l00552"></a>00552     <span class="keywordflow">for</span> (i=0 ; i&lt;(length-3) ; i++)
<a name="l00553"></a>00553         tmpstr = g_utf8_next_char (tmpstr);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555     tmpstr[0] = <span class="charliteral">&#39;.&#39;</span>;
<a name="l00556"></a>00556     tmpstr = g_utf8_next_char (tmpstr);
<a name="l00557"></a>00557     tmpstr[0] = <span class="charliteral">&#39;.&#39;</span>;
<a name="l00558"></a>00558     tmpstr = g_utf8_next_char (tmpstr);
<a name="l00559"></a>00559     tmpstr[0] = <span class="charliteral">&#39;.&#39;</span>;
<a name="l00560"></a>00560     tmpstr = g_utf8_next_char (tmpstr);
<a name="l00561"></a>00561     tmpstr[0] = 0;
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     <span class="keywordflow">return</span> string_return;
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 
<a name="l00576"></a><a class="code" href="utils__str_8h.html#a91319e0a1698979ebbfa69d2406b37d8">00576</a> GSList *<a class="code" href="utils__str_8c.html#a91319e0a1698979ebbfa69d2406b37d8">gsb_string_get_int_list_from_string</a> ( <span class="keyword">const</span> gchar *<span class="keywordtype">string</span>,
<a name="l00577"></a>00577                         gchar *delimiter )
<a name="l00578"></a>00578 {
<a name="l00579"></a>00579     GSList *list_tmp;
<a name="l00580"></a>00580     gchar **tab;
<a name="l00581"></a>00581     gint i=0;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583     <span class="keywordflow">if</span> ( !<span class="keywordtype">string</span>
<a name="l00584"></a>00584          ||
<a name="l00585"></a>00585          !delimiter
<a name="l00586"></a>00586          ||
<a name="l00587"></a>00587          !strlen (<span class="keywordtype">string</span>)
<a name="l00588"></a>00588          ||
<a name="l00589"></a>00589          !strlen (delimiter))
<a name="l00590"></a>00590         <span class="keywordflow">return</span> NULL;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592     tab = g_strsplit ( <span class="keywordtype">string</span>,
<a name="l00593"></a>00593                        delimiter,
<a name="l00594"></a>00594                        0 );
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     list_tmp = NULL;
<a name="l00597"></a>00597 
<a name="l00598"></a>00598     <span class="keywordflow">while</span> ( tab[i] )
<a name="l00599"></a>00599     {
<a name="l00600"></a>00600         list_tmp = g_slist_append ( list_tmp,
<a name="l00601"></a>00601                                     GINT_TO_POINTER ( atoi (tab[i])));
<a name="l00602"></a>00602         i++;
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     g_strfreev ( tab );
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="keywordflow">return</span> list_tmp;
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 
<a name="l00621"></a><a class="code" href="utils__str_8h.html#a1a167ac822379a89b7f87698cc79cfe8">00621</a> GSList *<a class="code" href="utils__str_8c.html#a1a167ac822379a89b7f87698cc79cfe8">gsb_string_get_string_list_from_string</a> ( <span class="keyword">const</span> gchar *<span class="keywordtype">string</span>,
<a name="l00622"></a>00622                         gchar *delimiter )
<a name="l00623"></a>00623 {
<a name="l00624"></a>00624     GSList *list_tmp;
<a name="l00625"></a>00625     gchar **tab;
<a name="l00626"></a>00626     gint i=0;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628     <span class="keywordflow">if</span> ( !<span class="keywordtype">string</span>
<a name="l00629"></a>00629          ||
<a name="l00630"></a>00630          !delimiter
<a name="l00631"></a>00631          ||
<a name="l00632"></a>00632          !strlen (<span class="keywordtype">string</span>)
<a name="l00633"></a>00633          ||
<a name="l00634"></a>00634          !strlen (delimiter))
<a name="l00635"></a>00635         <span class="keywordflow">return</span> NULL;
<a name="l00636"></a>00636 
<a name="l00637"></a>00637     tab = g_strsplit ( <span class="keywordtype">string</span>,
<a name="l00638"></a>00638                        delimiter,
<a name="l00639"></a>00639                        0 );
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     list_tmp = NULL;
<a name="l00642"></a>00642 
<a name="l00643"></a>00643     <span class="keywordflow">while</span> ( tab[i] )
<a name="l00644"></a>00644     {
<a name="l00645"></a>00645         list_tmp = g_slist_append ( list_tmp,
<a name="l00646"></a>00646                                     <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a>  (tab[i]));
<a name="l00647"></a>00647         i++;
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     g_strfreev ( tab );
<a name="l00651"></a>00651 
<a name="l00652"></a>00652     <span class="keywordflow">return</span> list_tmp;
<a name="l00653"></a>00653 }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 
<a name="l00665"></a><a class="code" href="utils__str_8h.html#a2cdd922452888e0a6349b4ce2cb38256">00665</a> GSList *<a class="code" href="utils__str_8c.html#a2cdd922452888e0a6349b4ce2cb38256">gsb_string_get_categ_budget_struct_list_from_string</a> ( <span class="keyword">const</span> gchar *<span class="keywordtype">string</span> )
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667     GSList *list_tmp = NULL;
<a name="l00668"></a>00668     gchar **tab;
<a name="l00669"></a>00669     gint i=0;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     <span class="keywordflow">if</span> ( !<span class="keywordtype">string</span>
<a name="l00672"></a>00672          ||
<a name="l00673"></a>00673          !strlen (<span class="keywordtype">string</span>))
<a name="l00674"></a>00674         <span class="keywordflow">return</span> NULL;
<a name="l00675"></a>00675 
<a name="l00676"></a>00676     tab = g_strsplit ( <span class="keywordtype">string</span>,
<a name="l00677"></a>00677                        <span class="stringliteral">&quot;-&quot;</span>,
<a name="l00678"></a>00678                        0 );
<a name="l00679"></a>00679 
<a name="l00680"></a>00680     <span class="keywordflow">while</span> ( tab[i] )
<a name="l00681"></a>00681     {
<a name="l00682"></a>00682         <a class="code" href="structstruct__categ__budget__sel.html">struct_categ_budget_sel</a> *categ_budget_struct = NULL;
<a name="l00683"></a>00683         gchar **sub_tab;
<a name="l00684"></a>00684         gint j=0;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686         sub_tab = g_strsplit (tab[i], <span class="stringliteral">&quot;/&quot;</span>, 0);
<a name="l00687"></a>00687         <span class="keywordflow">while</span> (sub_tab[j])
<a name="l00688"></a>00688         {
<a name="l00689"></a>00689             <span class="keywordflow">if</span> (!categ_budget_struct)
<a name="l00690"></a>00690             {
<a name="l00691"></a>00691                 <span class="comment">/* no categ_budget_struct created, so we are on the category */</span>
<a name="l00692"></a>00692                 categ_budget_struct = g_malloc0 (<span class="keyword">sizeof</span> (<a class="code" href="structstruct__categ__budget__sel.html">struct_categ_budget_sel</a>));
<a name="l00693"></a>00693                 categ_budget_struct -&gt; div_number = <a class="code" href="utils__str_8c.html#a5653e4c704f0c344ca9d1549561f9cd3" title="Secured version of atoi.">utils_str_atoi</a>(sub_tab[j]);
<a name="l00694"></a>00694             }
<a name="l00695"></a>00695             <span class="keywordflow">else</span>
<a name="l00696"></a>00696             {
<a name="l00697"></a>00697                 <span class="comment">/* categ_budget_struct is created, so we are on sub-category */</span>
<a name="l00698"></a>00698                 categ_budget_struct -&gt; sub_div_numbers = g_slist_append (categ_budget_struct -&gt; sub_div_numbers,
<a name="l00699"></a>00699                                                                          GINT_TO_POINTER (<a class="code" href="utils__str_8c.html#a5653e4c704f0c344ca9d1549561f9cd3" title="Secured version of atoi.">utils_str_atoi</a> (sub_tab[j])));
<a name="l00700"></a>00700             }
<a name="l00701"></a>00701             j++;
<a name="l00702"></a>00702         }
<a name="l00703"></a>00703         g_strfreev (sub_tab);
<a name="l00704"></a>00704         list_tmp = g_slist_append (list_tmp, categ_budget_struct);
<a name="l00705"></a>00705         i++;
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707     g_strfreev ( tab );
<a name="l00708"></a>00708 
<a name="l00709"></a>00709     <span class="keywordflow">return</span> list_tmp;
<a name="l00710"></a>00710 }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712 
<a name="l00721"></a><a class="code" href="utils__str_8h.html#a2202aea628d0de82cdfee24ab00fc7f6">00721</a> gchar * <a class="code" href="utils__str_8c.html#a2202aea628d0de82cdfee24ab00fc7f6">gsb_string_truncate</a> ( gchar * <span class="keywordtype">string</span> )
<a name="l00722"></a>00722 {
<a name="l00723"></a>00723     <span class="keywordflow">return</span> gsb_string_truncate_n ( <span class="keywordtype">string</span>, 20, FALSE );
<a name="l00724"></a>00724 }
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 
<a name="l00737"></a>00737 gchar * gsb_string_truncate_n ( gchar * <span class="keywordtype">string</span>, <span class="keywordtype">int</span> n, gboolean hard_trunc )
<a name="l00738"></a>00738 {
<a name="l00739"></a>00739         gchar* result;
<a name="l00740"></a>00740     gchar * tmp = string, * trunc;
<a name="l00741"></a>00741 
<a name="l00742"></a>00742     <span class="keywordflow">if</span> ( ! <span class="keywordtype">string</span> )
<a name="l00743"></a>00743         <span class="keywordflow">return</span> NULL;
<a name="l00744"></a>00744 
<a name="l00745"></a>00745     <span class="keywordflow">if</span> ( strlen(<span class="keywordtype">string</span>) &lt; n )
<a name="l00746"></a>00746         <span class="keywordflow">return</span> <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> ( <span class="keywordtype">string</span> );
<a name="l00747"></a>00747     
<a name="l00748"></a>00748     tmp = <span class="keywordtype">string</span> + n;
<a name="l00749"></a>00749     <span class="keywordflow">if</span> ( ! hard_trunc &amp;&amp; ! ( tmp = strchr ( tmp, <span class="charliteral">&#39; &#39;</span> ) ) )
<a name="l00750"></a>00750     {
<a name="l00751"></a>00751         <span class="comment">/* We do not risk splitting the string in the middle of a</span>
<a name="l00752"></a>00752 <span class="comment">           UTF-8 accent ... the end is probably near btw. */</span>
<a name="l00753"></a>00753         <span class="keywordflow">return</span> <a class="code" href="utils__str_8c.html#ad9a37361694eeaa2847b0fe11389824d">my_strdup</a> ( <span class="keywordtype">string</span> );
<a name="l00754"></a>00754     }
<a name="l00755"></a>00755     <span class="keywordflow">else</span> 
<a name="l00756"></a>00756     {
<a name="l00757"></a>00757         <span class="keywordflow">while</span> ( ! isascii(*tmp) &amp;&amp; *tmp )
<a name="l00758"></a>00758             tmp++;
<a name="l00759"></a>00759 
<a name="l00760"></a>00760         trunc = g_strndup ( <span class="keywordtype">string</span>, ( tmp - <span class="keywordtype">string</span> ) );
<a name="l00761"></a>00761         result = g_strconcat ( trunc, <span class="stringliteral">&quot;...&quot;</span>, NULL );
<a name="l00762"></a>00762         g_free(trunc);
<a name="l00763"></a>00763         <span class="keywordflow">return</span> result;
<a name="l00764"></a>00764     }
<a name="l00765"></a>00765 }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767 
<a name="l00772"></a><a class="code" href="utils__str_8h.html#a5bc68bfec149a7cbfdc6ecc66a48f634">00772</a> gchar * <a class="code" href="utils__str_8c.html#a5bc68bfec149a7cbfdc6ecc66a48f634">gsb_string_remplace_string</a> ( gchar *str, gchar *old_str, gchar *new_str )
<a name="l00773"></a>00773 {
<a name="l00774"></a>00774     gchar *ptr_debut;
<a name="l00775"></a>00775     gint long_old;
<a name="l00776"></a>00776     gchar *chaine;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778     ptr_debut = g_strstr_len ( str, -1, old_str);
<a name="l00779"></a>00779     <span class="keywordflow">if</span> ( ptr_debut == NULL )
<a name="l00780"></a>00780         <span class="keywordflow">return</span> g_strdup ( str );
<a name="l00781"></a>00781 
<a name="l00782"></a>00782     long_old = g_utf8_strlen ( old_str, -1 );
<a name="l00783"></a>00783     chaine = g_strndup ( str, (ptr_debut - str) );
<a name="l00784"></a>00784     <span class="keywordflow">if</span> ( ptr_debut + long_old + 1 )
<a name="l00785"></a>00785         chaine = g_strconcat ( chaine, new_str, ( ptr_debut + long_old + 1 ), NULL );
<a name="l00786"></a>00786     <span class="keywordflow">else</span>
<a name="l00787"></a>00787         chaine = g_strconcat ( chaine, new_str, NULL );
<a name="l00788"></a>00788 
<a name="l00789"></a>00789     <span class="keywordflow">return</span> g_strdup ( chaine );
<a name="l00790"></a>00790 }
<a name="l00791"></a>00791 
<a name="l00792"></a>00792 
<a name="l00801"></a><a class="code" href="utils__str_8h.html#a4f7c837f05cb6ab362e401409acc461b">00801</a> gboolean <a class="code" href="utils__str_8c.html#a4f7c837f05cb6ab362e401409acc461b">gsb_string_is_trouve</a> ( <span class="keyword">const</span> gchar *payee_name, <span class="keyword">const</span> gchar *needle )
<a name="l00802"></a>00802 {
<a name="l00803"></a>00803     gchar **tab_str;
<a name="l00804"></a>00804     gchar *tmpstr;
<a name="l00805"></a>00805     gint i;
<a name="l00806"></a>00806     gboolean is_prefix = FALSE, is_suffix = FALSE;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808     <span class="keywordflow">if</span> ( g_strstr_len ( needle, -1, <span class="stringliteral">&quot;%&quot;</span> ) == NULL &amp;&amp; 
<a name="l00809"></a>00809                         g_strstr_len ( needle, -1, <span class="stringliteral">&quot;*&quot;</span> ) == NULL )
<a name="l00810"></a>00810     {
<a name="l00811"></a>00811         <span class="keywordflow">if</span> ( <a class="code" href="utils__str_8c.html#af2728abf4fbd2d14f13a3025211dab47">my_strcasecmp</a> ( payee_name, needle ) == 0 )
<a name="l00812"></a>00812             <span class="keywordflow">return</span> TRUE;
<a name="l00813"></a>00813         <span class="keywordflow">else</span>
<a name="l00814"></a>00814             <span class="keywordflow">return</span> FALSE;
<a name="l00815"></a>00815     }
<a name="l00816"></a>00816     <span class="keywordflow">if</span> ( g_str_has_prefix ( needle, <span class="stringliteral">&quot;%&quot;</span> ) == FALSE &amp;&amp;
<a name="l00817"></a>00817                         g_str_has_prefix ( needle, <span class="stringliteral">&quot;*&quot;</span> ) == FALSE )
<a name="l00818"></a>00818         is_prefix = TRUE;
<a name="l00819"></a>00819 
<a name="l00820"></a>00820     <span class="keywordflow">if</span> ( g_str_has_suffix ( needle, <span class="stringliteral">&quot;%&quot;</span> ) == FALSE &amp;&amp;
<a name="l00821"></a>00821                         g_str_has_suffix ( needle, <span class="stringliteral">&quot;*&quot;</span> ) == FALSE )
<a name="l00822"></a>00822         is_suffix = TRUE;
<a name="l00823"></a>00823 
<a name="l00824"></a>00824     <span class="keywordflow">if</span> ( is_prefix &amp;&amp; is_suffix )
<a name="l00825"></a>00825     {
<a name="l00826"></a>00826         tab_str = g_strsplit_set ( needle, <span class="stringliteral">&quot;%*&quot;</span>, 0 );
<a name="l00827"></a>00827         is_prefix = g_str_has_prefix ( payee_name, tab_str[0] );
<a name="l00828"></a>00828         is_suffix = g_str_has_suffix ( payee_name, tab_str[1] );
<a name="l00829"></a>00829         <span class="keywordflow">if</span> ( is_prefix &amp;&amp; is_suffix )
<a name="l00830"></a>00830             <span class="keywordflow">return</span> TRUE;
<a name="l00831"></a>00831         <span class="keywordflow">else</span>
<a name="l00832"></a>00832             <span class="keywordflow">return</span> FALSE;
<a name="l00833"></a>00833     }
<a name="l00834"></a>00834     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( is_prefix &amp;&amp; ! is_suffix )
<a name="l00835"></a>00835     {
<a name="l00836"></a>00836         tmpstr = gsb_string_supprime_joker ( needle );
<a name="l00837"></a>00837         is_prefix = g_str_has_prefix (payee_name, tmpstr);
<a name="l00838"></a>00838         g_free (tmpstr);
<a name="l00839"></a>00839         <span class="keywordflow">return</span> is_prefix;
<a name="l00840"></a>00840     }
<a name="l00841"></a>00841     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( is_suffix &amp;&amp; ! is_prefix )
<a name="l00842"></a>00842     {
<a name="l00843"></a>00843         tmpstr = gsb_string_supprime_joker ( needle );
<a name="l00844"></a>00844         is_suffix = g_str_has_suffix (payee_name, tmpstr);
<a name="l00845"></a>00845         g_free (tmpstr);
<a name="l00846"></a>00846         <span class="keywordflow">return</span> is_suffix;
<a name="l00847"></a>00847     }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849     tab_str = g_strsplit_set ( needle, <span class="stringliteral">&quot;%*&quot;</span>, 0 );
<a name="l00850"></a>00850 
<a name="l00851"></a>00851     <span class="keywordflow">for</span> (i = 0; tab_str[i] != NULL; i++)
<a name="l00852"></a>00852         {
<a name="l00853"></a>00853         <span class="keywordflow">if</span> ( tab_str[i] &amp;&amp; strlen (tab_str[i]) &gt; 0)
<a name="l00854"></a>00854         {
<a name="l00855"></a>00855             <span class="keywordflow">if</span> ( g_strstr_len (payee_name, -1, tab_str[i]))
<a name="l00856"></a>00856                 <span class="keywordflow">return</span> TRUE;
<a name="l00857"></a>00857         }
<a name="l00858"></a>00858     }
<a name="l00859"></a>00859     <span class="keywordflow">return</span> FALSE;
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 
<a name="l00871"></a><a class="code" href="utils__str_8h.html#aad2ed2c5c3098fad8c62053320dbe3cb">00871</a> gchar * <a class="code" href="utils__str_8c.html#aad2ed2c5c3098fad8c62053320dbe3cb">gsb_string_remplace_joker</a> ( <span class="keyword">const</span> gchar *chaine, gchar *new_str )
<a name="l00872"></a>00872 {
<a name="l00873"></a>00873     gchar **tab_str;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875     tab_str = g_strsplit_set ( chaine, <span class="stringliteral">&quot;%*&quot;</span>, 0 );
<a name="l00876"></a>00876     <span class="keywordflow">return</span> g_strjoinv ( new_str, tab_str );
<a name="l00877"></a>00877 }
<a name="l00878"></a>00878 
<a name="l00879"></a>00879 
<a name="l00887"></a>00887 gchar *gsb_string_supprime_joker ( <span class="keyword">const</span> gchar *chaine )
<a name="l00888"></a>00888 {
<a name="l00889"></a>00889     gchar **tab_str;
<a name="l00890"></a>00890 
<a name="l00891"></a>00891     tab_str = g_strsplit_set ( chaine, <span class="stringliteral">&quot;%*&quot;</span>, 0 );
<a name="l00892"></a>00892     <span class="keywordflow">return</span> g_strjoinv ( <span class="stringliteral">&quot;&quot;</span>, tab_str );
<a name="l00893"></a>00893 }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 <span class="comment">/*</span>
<a name="l00897"></a>00897 <span class="comment"> * extrait un nombre d&#39;une chaine</span>
<a name="l00898"></a>00898 <span class="comment"> * </span>
<a name="l00899"></a>00899 <span class="comment"> * \param chaine</span>
<a name="l00900"></a>00900 <span class="comment"> *</span>
<a name="l00901"></a>00901 <span class="comment"> * \return guint</span>
<a name="l00902"></a>00902 <span class="comment"> */</span>
<a name="l00903"></a><a class="code" href="utils__str_8h.html#a573a6cddf4b47bcd3a0790575304e4a8">00903</a> gchar *<a class="code" href="utils__str_8c.html#a573a6cddf4b47bcd3a0790575304e4a8">gsb_string_extract_int</a> ( <span class="keyword">const</span> gchar *chaine )
<a name="l00904"></a>00904 {
<a name="l00905"></a>00905     gchar *ptr;
<a name="l00906"></a>00906     gchar *tmpstr;
<a name="l00907"></a>00907     gunichar ch;
<a name="l00908"></a>00908     gint i = 0;
<a name="l00909"></a>00909     gint long_nbre = 64;
<a name="l00910"></a>00910 
<a name="l00911"></a>00911     tmpstr = g_malloc0 ( long_nbre * <span class="keyword">sizeof</span> (gchar) );
<a name="l00912"></a>00912     ptr = g_strdup ( chaine );
<a name="l00913"></a>00913     <span class="keywordflow">while</span> ( g_utf8_strlen (ptr, -1) &gt; 0 )
<a name="l00914"></a>00914     {
<a name="l00915"></a>00915         ch = g_utf8_get_char_validated (ptr, -1);
<a name="l00916"></a>00916         <span class="keywordflow">if</span> ( g_unichar_isdefined ( ch ) &amp;&amp; g_ascii_isdigit ( ch ) )
<a name="l00917"></a>00917         {
<a name="l00918"></a>00918             <span class="keywordflow">if</span> ( i == long_nbre )
<a name="l00919"></a>00919                 <span class="keywordflow">break</span>;
<a name="l00920"></a>00920             tmpstr[i] = ptr[0];
<a name="l00921"></a>00921             i++;
<a name="l00922"></a>00922         }
<a name="l00923"></a>00923         ptr = g_utf8_next_char (ptr);
<a name="l00924"></a>00924     }
<a name="l00925"></a>00925 
<a name="l00926"></a>00926     <span class="keywordflow">return</span> tmpstr;
<a name="l00927"></a>00927 }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929 
<a name="l00937"></a><a class="code" href="utils__str_8h.html#ab54b5cc09462d6075a7846447d02e2ad">00937</a> gchar *<a class="code" href="utils__str_8c.html#ab54b5cc09462d6075a7846447d02e2ad">gsb_string_uniform_new_line</a> ( <span class="keyword">const</span> gchar *chaine, gint nbre_char )
<a name="l00938"></a>00938 {
<a name="l00939"></a>00939     gchar **tab_str;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941     <span class="keywordflow">if</span> ( g_strstr_len ( chaine, nbre_char, <span class="stringliteral">&quot;\r\n&quot;</span> ) )
<a name="l00942"></a>00942     {
<a name="l00943"></a>00943         tab_str = g_strsplit_set ( chaine, <span class="stringliteral">&quot;\r&quot;</span>, 0 );
<a name="l00944"></a>00944         <span class="keywordflow">return</span> g_strjoinv ( <span class="stringliteral">&quot;&quot;</span>, tab_str );
<a name="l00945"></a>00945     }
<a name="l00946"></a>00946     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( g_strstr_len ( chaine, nbre_char, <span class="stringliteral">&quot;\r&quot;</span> ) 
<a name="l00947"></a>00947      &amp;&amp; 
<a name="l00948"></a>00948      !g_strstr_len ( chaine, nbre_char, <span class="stringliteral">&quot;\n&quot;</span> ) )
<a name="l00949"></a>00949     {
<a name="l00950"></a>00950         tab_str = g_strsplit_set ( chaine, <span class="stringliteral">&quot;\r&quot;</span>, 0 );
<a name="l00951"></a>00951         <span class="keywordflow">return</span> g_strjoinv ( <span class="stringliteral">&quot;\n&quot;</span>, tab_str );
<a name="l00952"></a>00952     }
<a name="l00953"></a>00953     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( g_strstr_len ( chaine, nbre_char, <span class="stringliteral">&quot;\n&quot;</span> ) )
<a name="l00954"></a>00954         <span class="keywordflow">return</span> g_strdup ( chaine );
<a name="l00955"></a>00955     <span class="keywordflow">else</span>
<a name="l00956"></a>00956         <span class="keywordflow">return</span> NULL;
<a name="l00957"></a>00957 }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959 
<a name="l00966"></a><a class="code" href="utils__str_8h.html#a223cea3f0d88df38e526d57e491bd27a">00966</a> gchar *<a class="code" href="utils__str_8c.html#a223cea3f0d88df38e526d57e491bd27a">utils_str_dtostr</a> ( gdouble number, gint nbre_decimal, gboolean canonical )
<a name="l00967"></a>00967 {
<a name="l00968"></a>00968     gchar buffer[G_ASCII_DTOSTR_BUF_SIZE];
<a name="l00969"></a>00969     gchar *str_number;
<a name="l00970"></a>00970     gchar *format;
<a name="l00971"></a>00971     gint nbre_char;
<a name="l00972"></a>00972 
<a name="l00973"></a>00973     format = g_strconcat ( <span class="stringliteral">&quot;%.&quot;</span>, <a class="code" href="utils__str_8c.html#a1e50f3be459180b9dea9f14eb7e1204e" title="convert an integer into a gchar based string">utils_str_itoa</a> ( nbre_decimal ), <span class="stringliteral">&quot;f&quot;</span>, NULL );
<a name="l00974"></a>00974 
<a name="l00975"></a>00975     nbre_char = g_sprintf ( buffer, format, number );
<a name="l00976"></a>00976     <span class="keywordflow">if</span> ( nbre_char &gt; G_ASCII_DTOSTR_BUF_SIZE )
<a name="l00977"></a>00977         <span class="keywordflow">return</span> NULL;
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     str_number = g_strndup ( buffer, nbre_char );
<a name="l00980"></a>00980 
<a name="l00981"></a>00981     <span class="keywordflow">if</span> ( canonical &amp;&amp; g_strrstr ( str_number, <span class="stringliteral">&quot;,&quot;</span> ) )
<a name="l00982"></a>00982         str_number = <a class="code" href="utils__str_8c.html#a132f77383d5b1e3070ef354a1fdd8a10">my_strdelimit</a> ( str_number, <span class="stringliteral">&quot;,&quot;</span>, <span class="stringliteral">&quot;.&quot;</span> );
<a name="l00983"></a>00983 
<a name="l00984"></a>00984     <span class="keywordflow">return</span> str_number;
<a name="l00985"></a>00985 }
<a name="l00986"></a>00986 
<a name="l00987"></a>00987 
<a name="l00988"></a>00988 <span class="comment">/* Local Variables: */</span>
<a name="l00989"></a>00989 <span class="comment">/* c-basic-offset: 4 */</span>
<a name="l00990"></a>00990 <span class="comment">/* End: */</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Généré le Sat Aug 7 22:12:03 2010 pour Grisbi par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
